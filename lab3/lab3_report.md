University: ITMO University

Faculty: FICT

Course: Network programming

Year: 2023

Group: K34212

Author: Glebov Ivan Igorevich

Lab: Lab3

Date of create: 01.12.2023

Date of finished: 01.12.2023

Ход работы:

1. Поднимаем Ubuntu 20.04 на виртуальной машине на хосте. Она будет предназначена для NetBox. Соединяем её с виртуальной машиной в облаке Яндекса, используя Wireguard по аналогии с первой лабораторной работой. Проверяем, что связь есть (192.168.6.1 - IP адрес виртуальной машины в Яндексе)
![img](step1.png)

2. Запускаем Netbox. Это требует установки большого количества зависимостей. Далее первый этап - это установка и настройка postgresql. Создаем базу данных Netbox с одноимённым пользователем, запускаем. Проверяем, что всё работает корректно.
![img](step2.png)
3. После этого настраиваем nginx, добавляем туда информацию о Netbox. Поскольку всё будет разворачиваться локально, указываем локалхост в конфигурационном файле. После этого можно запустить сам Netbox и проверить, что он запускается корректно.
![img](step3.png)
4. Далее в браузере открываем ссылку на netbox и видим главную страницу.
![img](step4.png)
5. Изначально там нет никакой информации, мы вносим два наших роутера. В моём случае занесены Сайт и сопутствующая информация для того, чтобы можно было добавить роутер.
![img](step5.png)

6. Далее вносим роутеры и информацию о них. На скриншоте также присутствует IP адрес, но по факту он будет внесён позднее.
![img](step6.png)

7. Для внесения IP адреса требуется создать интерфейс на роутере. Таким образом, в Netbox записаны два роутера, их ID, названия, интерфейсы и IP адреса.
![img](step7.png)

8. Сохраняем всю эту информацию в формате csv. Файл присутствует в этой папке.
![img](step8.png)
9. Подключаемся по ssh с виртуальной машины Ubuntu на облачную машину и при помощи команды scp передаём этот файл в облачную машину. Он потребуется нам для работы с Ansible.
10. Начинаем работу над плейбуком. В папке он представлен в итоговом виде, во время работы я разделила основную цель на две подзадачи. Первая - спарсить csv файл и записать нужную нам информацию о роутере в отдельный файл. В данном случае за ключ берём UID роутера, так как это значение не будет изменяться. 
![img](step10.png)
 11. Запускаем, чтобы проверить правильность вывода. 
![img](step11.png)
12. Теперь дописываем часть, связанную с установкой названия роутера. 
![img](step12.png)

13. И запускаем весь плейбук целиком, в результате чего он берёт имя роутера из csv файла, сгенерированного Netbox, и присваивает это имя подключенному роутеру. Вывод результатов показывает, что всё работает корректно.
![img](step13.png)
14. В консоли Микротика видим, что имя роутера изменилось.
![img](step14.png)
15. Теперь работаем над обратной задачей - необходимо информацию из роутера передать в Netbox. Для начала пишем просто скрипт создания девайся в Netbox.
![img](step15.png)

16. Заходим в Netbox и проверяем, что он сработал.
![img](step16.png)

17. Далее реализуем ту часть задания, в которой информация достаётся из Микротика и передаётся в файл на виртуальной машине в облаке.
![img](step17.png)
18. И теперь вносим эту информацию в Netbox. В моём случае создаётся девайс, в котором часть настроек предопределено, а имя используется то, которое было взято из Микротика.
![img](step18.png)
19. Запускаем итоговый файл, видим корректный вывод от ansible.
![img](step19.png)

20. Заходим в Netbox и проверяем, сохранились ли изменения. Есть информация о добавлении R1 - следовательно, задача выполнена.
![img](step20.png)

Выводы: Мы познакомились с довольно интересным и очень гибким инструментом для документирования сетей - Netbox. Также узнали, насколько многофункционален ansible, так как с его помощью можно довольно просто решать сложные и долгие задачи, автоматизируя весь процесс.

